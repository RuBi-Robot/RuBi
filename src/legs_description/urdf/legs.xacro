<?xml version="1.0"?>

<robot name="legs" xmlns:xacro="http://www.ros.org/wiki/xacro">

	<!-- Constants -->
	<xacro:property name="PI" value="3.1415926535897931"/>
	<xacro:property name="DEG_TO_RAD" value="${PI/180}"/>

	<!-- ROS -->
	<xacro:property name="update_rate" value="10"/>
	<xacro:property name="robot_name" value="legs"/>

  <!-- Robot configuration: Miscellaneous -->
  <xacro:property name="robot_floating" value="0"/>

	<!-- Robot configuration: Transmission -->
	<xacro:property name="max_real_motor_torque" value="1.0787315"/> <!-- In N*m -->

  <!-- Robot configuration: Geometry 
    Width = X axis
    Length = Y axis
    Height = Z axis
  -->
  <xacro:property name="scale" value="1" />
  <xacro:property name="minimum_intertia" value="0.002" /> <!-- <0.001 doesn't work -->

  <xacro:property name="upperLegHeight" value="0.262" />
  <xacro:property name="upperLegDiameter" value="0.02" />
	<xacro:property name="upperLegMass" value="0.163" />
  <xacro:property name="upperLegLimitUpperPosition" value="90" />
  <xacro:property name="upperLegLimitLowerPosition" value="-60" />
  <xacro:property name="upperLegLimitVelocity" value="10" />
  <xacro:property name="upperLegLimitEffort" value="10" />
  <xacro:property name="upperLegDamping" value="0.7" />

  <xacro:property name="lowerLegHeight" value="0.212" />
  <xacro:property name="lowerLegDiameter" value="0.02" />
	<xacro:property name="lowerLegMass" value="0.17" />
  <xacro:property name="lowerLegLimitUpperPosition" value="0" />
  <xacro:property name="lowerLegLimitLowerPosition" value="-120" />
  <xacro:property name="lowerLegLimitVelocity" value="10" />
  <xacro:property name="lowerLegLimitEffort" value="10" />
  <xacro:property name="lowerLegDamping" value="0.7" />

	<xacro:property name="footMass" value="0.0296" />
  <xacro:property name="footLimitUpperPosition" value="120" />
  <xacro:property name="footLimitLowerPosition" value="-50" />
  <xacro:property name="footLimitVelocity" value="10" />
  <xacro:property name="footLimitEffort" value="10" />
  <xacro:property name="footDamping" value="0.7" />

	<xacro:property name="legDistFromCenter" value="0.0635" />

  <xacro:property name="hipMass" value="${0.45}" />

	<xacro:property name="footAnklePos" value="${0.015}" />
	<xacro:property name="legAnklePos" value="${0}" />
	<xacro:property name="lowerKneePos" value="${0.12}" />
	<xacro:property name="upperKneePos" value="${0.02}" />
	<xacro:property name="legHipPos" value="${0.132}" />
	<xacro:property name="bodyHipHeight" value="${0.01}" />
	<xacro:property name="bodyHipWidth" value="${0.025}" />

	<!-- Import Gazebo customizations and colors-->
	<xacro:include filename="$(find legs_description)/urdf/legs.gazebo" />
	<xacro:include filename="$(find legs_description)/urdf/colors.xacro" />


	<!-- 
		Macros
	 -->


		<!-- Intertia Macro: Set the minimum intertia -->
<!--   <xacro:macro name="check_minimum_intertia" params="inertia">

		<xacro:if value="${inertia < 0.01}">
			<xacro:property name="inertia" value="${mass / 12.0 * (3*(diameter/2)^2 + height^2)}" />
		</xacro:if>

    <xacro:if value="${inertia < 0.01}">
      <xacro:property name="inertia" value="${mass / 12.0 * (3*(diameter/2)^2 + height^2)}" />
    </xacro:if>

    <xacro:if value="${inertia < 0.01}">
      <xacro:property name="inertia" value="${mass / 12.0 * (3*(diameter/2)^2 + height^2)}" />
    </xacro:if>

	</xacro:macro>
 -->

	<!-- 
		World
	-->
	<!-- <link name="legs_global"/> -->

	<!-- 
		Left Leg
	-->

    <link name="hip">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/hip_visual.stl"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/hip_visual.stl"/>
        </geometry>
        <material name="orange"/>
      </visual>

      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.01"/>
        <inertia
          ixx="0.01" ixy="0.0" ixz="0.0" 
          iyy="0.01" iyz="0.0" 
          izz="0.01"/>
      </inertial>
    </link>

    <link name="left_upper_limb">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/left_upper_limb_visual.stl"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/left_upper_limb_visual.stl"/>
        </geometry>
        <material name="orange"/>
      </visual>

      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.01"/>
        <inertia
          ixx="0.01" ixy="0.0" ixz="0.0" 
          iyy="0.01" iyz="0.0" 
          izz="0.01"/>
      </inertial>
    </link>

    <link name="left_lower_limb">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/left_lower_limb_visual.stl"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/left_lower_limb_visual.stl"/>
        </geometry>
        <material name="orange"/>
      </visual>

      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.01"/>
        <inertia
          ixx="0.01" ixy="0.0" ixz="0.0" 
          iyy="0.01" iyz="0.0" 
          izz="0.01"/>
      </inertial>
    </link>

    <link name="left_foot">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/left_foot_visual.stl"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/left_foot_visual.stl"/>
        </geometry>
        <material name="orange"/>
      </visual>

      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.01"/>
        <inertia
          ixx="0.01" ixy="0.0" ixz="0.0" 
          iyy="0.01" iyz="0.0" 
          izz="0.01"/>
      </inertial>
    </link>

    <link name="right_upper_limb">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/right_upper_limb_visual.stl"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/right_upper_limb_visual.stl"/>
        </geometry>
        <material name="orange"/>
      </visual>

      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.01"/>
        <inertia
          ixx="0.01" ixy="0.0" ixz="0.0" 
          iyy="0.01" iyz="0.0" 
          izz="0.01"/>
      </inertial>
    </link>

    <link name="right_lower_limb">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/right_lower_limb_visual.stl"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/right_lower_limb_visual.stl"/>
        </geometry>
        <material name="orange"/>
      </visual>

      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.01"/>
        <inertia
          ixx="0.01" ixy="0.0" ixz="0.0" 
          iyy="0.01" iyz="0.0" 
          izz="0.01"/>
      </inertial>
    </link>

    <link name="right_foot">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/right_foot_visual.stl"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://legs_description/meshes/iteration_1/gazebo/right_foot_visual.stl"/>
        </geometry>
        <material name="orange"/>
      </visual>

      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.01"/>
        <inertia
          ixx="0.01" ixy="0.0" ixz="0.0" 
          iyy="0.01" iyz="0.0" 
          izz="0.01"/>
      </inertial>
    </link>

  <!-- 
    Virtual links
  -->
  <link name="world"/>

<!--   <link name="plane_x">
    <inertial>
      <mass value="2e-06"/>
      <inertia ixx="1.1e-09" ixy="0" ixz="0" iyy="1.1e-09" iyz="0" izz="1.1e-09"/>
    </inertial>
  </link> -->

	<!-- 
		Joints 
	-->
<!--   <joint name="world_plane_x" type="planar">
    <parent link="world"/>
    <child link="plane_x"/>
    <origin xyz="0 0 1" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>
  </joint> 

  <joint name="plane_x_body" type="continuous">
    <parent link="plane_x"/>
    <child link="hip"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>
  </joint>  -->

  <joint name="world_hip" type="fixed">
    <parent link="world"/>
    <child link="hip"/>
    <origin xyz="0 0 1" rpy="0 0 0"/>
  </joint> 

  <joint name="left_hip" type="revolute">
    <parent link="hip"/>
    <child link="left_upper_limb"/>
    <origin xyz="0 0.0635 -0.028867" rpy="${-90*DEG_TO_RAD} 0 0"/>
    <axis xyz="0 0 -1"/>
    <limit effort="${upperLegLimitEffort}" velocity="${upperLegLimitVelocity}" lower="${upperLegLimitLowerPosition*DEG_TO_RAD}" upper="${upperLegLimitUpperPosition*DEG_TO_RAD}" />
    <dynamics damping="${upperLegDamping}"/>
  </joint>

  <joint name="left_knee" type="revolute">
    <parent link="left_upper_limb"/>
    <child link="left_lower_limb"/>
    <origin xyz="0 0.262 0" rpy="0 0 0"/>
    <axis xyz="0 0 -1"/>
    <limit effort="${lowerLegLimitEffort}" velocity="${lowerLegLimitVelocity}" lower="${lowerLegLimitLowerPosition*DEG_TO_RAD}" upper="${lowerLegLimitUpperPosition*DEG_TO_RAD}" />
    <dynamics damping="${lowerLegDamping}"/>
  </joint> 

  <joint name="left_ankle" type="revolute">
    <parent link="left_lower_limb"/>
    <child link="left_foot"/>
    <origin xyz="0 0.212 0" rpy="0 0 0"/>
    <axis xyz="0 0 -1"/>
    <limit effort="${footLimitEffort}" velocity="${footLimitVelocity}" lower="${footLimitLowerPosition*DEG_TO_RAD}" upper="${footLimitUpperPosition*DEG_TO_RAD}" />
    <dynamics damping="${footDamping}"/>
  </joint> 

  <joint name="right_hip" type="revolute">
    <parent link="hip"/>
    <child link="right_upper_limb"/>
    <origin xyz="0 -0.0635 -0.028867" rpy="${-90*DEG_TO_RAD} 0 0"/>
    <axis xyz="0 0 -1"/>
    <limit effort="${upperLegLimitEffort}" velocity="${upperLegLimitVelocity}" lower="${upperLegLimitLowerPosition*DEG_TO_RAD}" upper="${upperLegLimitUpperPosition*DEG_TO_RAD}" />
    <dynamics damping="${upperLegDamping}"/>
  </joint>

  <joint name="right_knee" type="revolute">
    <parent link="right_upper_limb"/>
    <child link="right_lower_limb"/>
    <origin xyz="0 0.262 0" rpy="0 0 0"/>
    <axis xyz="0 0 -1"/>
    <limit effort="${lowerLegLimitEffort}" velocity="${lowerLegLimitVelocity}" lower="${lowerLegLimitLowerPosition*DEG_TO_RAD}" upper="${lowerLegLimitUpperPosition*DEG_TO_RAD}" />
    <dynamics damping="${lowerLegDamping}"/>
  </joint> 

  <joint name="right_ankle" type="revolute">
    <parent link="right_lower_limb"/>
    <child link="right_foot"/>
    <origin xyz="0 0.212 0" rpy="0 0 0"/>
    <axis xyz="0 0 -1"/>
    <limit effort="${footLimitEffort}" velocity="${footLimitVelocity}" lower="${footLimitLowerPosition*DEG_TO_RAD}" upper="${footLimitUpperPosition*DEG_TO_RAD}" />
    <dynamics damping="${footDamping}"/>
  </joint> 

  <transmission name="left_hip_trans">
    <type>transmission_interface/SimpleTransmission</type>
      <joint name="left_hip">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="left_hip_motor">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
      <mechanicalReduction>${max_real_motor_torque}</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="left_knee_trans">
    <type>transmission_interface/SimpleTransmission</type>
      <joint name="left_knee">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="left_knee_motor">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
      <mechanicalReduction>${max_real_motor_torque}</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="left_ankle_trans">
    <type>transmission_interface/SimpleTransmission</type>
      <joint name="left_ankle">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="left_ankle_motor">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
      <mechanicalReduction>${max_real_motor_torque}</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="right_hip_trans">
    <type>transmission_interface/SimpleTransmission</type>
      <joint name="right_hip">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="right_hip_motor">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
      <mechanicalReduction>${max_real_motor_torque}</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="right_knee_trans">
    <type>transmission_interface/SimpleTransmission</type>
      <joint name="right_knee">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="right_knee_motor">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
      <mechanicalReduction>${max_real_motor_torque}</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="right_ankle_trans">
    <type>transmission_interface/SimpleTransmission</type>
      <joint name="right_ankle">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="right_ankle_motor">
      <hardwareInterface>EffortJointInterface</hardwareInterface>
      <mechanicalReduction>${max_real_motor_torque}</mechanicalReduction>
    </actuator>
  </transmission>

</robot>